<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Book my Show</h1>
    <form action="/book-show" method="post">
        <label for="show-name">Show Name:</label>
        <input type="text" id="show-name" name="show-name" required>
        <br><br>
        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>
        <br><br>    
        <label for="time">Time:</label>
        <input type="time" id="time" name="time" required>
        <br><br>
        <label for="seats">Number of Seats:</label>
        <input type="number" id="seats" name="seats" min="1" required>
        <br><br>
        <input type="submit" value="Book Show">
        <input type="reset" value="Clear Form">
        <br><br>
        <p>Note: Booking a show requires a valid credit card.</p>
        <div id="payment-form">
            <label for="card-number">Credit Card Number:</label>
            <input type="text" id="card-number" name="card-number" required>
            <br><br>
            <label for="expiry-date">Expiry Date:</label>
            <input type="text" id="expiry-date" name="expiry-date" placeholder="MM/YY" required>
            <br><br>
            <label for="cvv">CVV:</label>
            <input type="text" id="cvv" name="cvv" required>
            <br><br>
            <input type="submit" value="Pay Now">
            <input type="reset" value="Clear Form">
            <br><br>
            <p>Secure payment processing by <img src="https://www.paypalobjects.com/webstatic/en_US/i/logo/PP_mark_logo_195x46.png" alt="PayPal Logo"></p>
            <p>Payment terms and conditions apply.</p>
            <div id="payment-errors"></div>
            <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>
            <script>
                const payPal = window.paypal;
                const cardForm = document.getElementById('payment-form');
                const paymentErrors = document.getElementById('payment-errors');
                
                cardForm.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    paymentErrors.textContent = '';
                    try {
                        const cardNumber = cardForm.cardNumber.value;
                        const expiryDate = cardForm.expiryDate.value;
                        const cvv = cardForm.cvv.value;
                        const response = await payPal.request({
                            method: 'POST',
                            url: 'https://api.sandbox.paypal.com/v1/payments/payment',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer YOUR_SANDBOX_ACCESS_TOKEN'
                            },
                            body: JSON.stringify({
                                intent: 'CAPTURE',
                                payer: {
                                    payment_method: 'credit_card',
                                    credit_card: {
                                        number: cardNumber,
                                        expire_month: expiryDate.split('/')[0],
                                        expire_year: expiryDate.split('/')[1],
                                        cvv: cvv
                                    }
                                },
                                transactions: [{
                                     amount: {
                                        total: '10.00',
                                        currency: 'USD'
                                     },
                                     description: 'Book a show'
                                     }]
                            })
                        });
                        console.log(response);
                        alert('Payment successful!');
                        cardForm.reset();
                        paymentErrors.textContent = '';
                        payPal.resetCard();
                        payPal.clearElements();
                        // Update the payment status in your backend
                        // Example: updatePaymentStatus(response.id, 'PAID');
                    } catch (error) {
                        paymentErrors.textContent = error.response.details[0].issue;
                    }
                })
            </script>
        </div>
</body>
</html>